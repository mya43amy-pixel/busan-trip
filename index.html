<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 busan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        :root {
            --primary: #8ABDBF;
            --bg-light: #F8FAFA;
            --text-dark: #334155;
            --card-white: #FFFFFF;
        }

        body {
            font-family: 'Montserrat', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            padding-bottom: 80px;
        }

        .header-bg {
            background-color: var(--primary);
            border-radius: 0 0 40px 40px;
            box-shadow: 0 4px 15px rgba(138, 189, 191, 0.2);
        }

        .date-btn {
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .date-btn.active {
            background: white;
            color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card {
            background: var(--card-white);
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.03);
            transition: transform 0.2s;
        }

        .shop-img {
            width: 100%;
            height: auto; /* è®“åœ–ç‰‡ä¾æ¯”ä¾‹é¡¯ç¤ºï¼Œä¸å†å¼·åˆ¶æ­£æ–¹å½¢ */
            max-height: 300px;
            object-fit: contain; /* å®Œæ•´é¡¯ç¤ºåœ–ç‰‡å…§å®¹ */
            border-radius: 16px;
            background: #f1f5f9;
        }

        .nav-bar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 50;
            align-items: flex-end;
        }

        .modal-content {
            background: white;
            width: 100%;
            border-radius: 30px 30px 0 0;
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }

        .modal.active { display: flex; }
        .modal.active .modal-content { transform: translateY(0); }

        /* éš±è—åŸç”Ÿå·è»¸ */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div class="header-bg p-6 text-white text-center">
        <h1 class="text-xl font-bold tracking-widest mb-4">2026 BUSAN âš“</h1>
        <div class="flex justify-between gap-2 overflow-x-auto pb-2" id="dateTabs">
            </div>
    </div>

    <main class="p-5 max-w-md mx-auto" id="mainContent">
        </main>

    <nav class="nav-bar fixed bottom-0 left-0 right-0 h-20 flex justify-around items-center px-6 z-40">
        <button onclick="switchTab('plan')" class="nav-item flex flex-col items-center text-gray-400">
            <i class="fa-solid fa-calendar-alt text-xl mb-1"></i>
            <span class="text-[10px] font-bold">PLAN</span>
        </button>
        <button onclick="switchTab('wallet')" class="nav-item flex flex-col items-center text-gray-400">
            <i class="fa-solid fa-wallet text-xl mb-1"></i>
            <span class="text-[10px] font-bold">WALLET</span>
        </button>
        <div onclick="openAddModal()" class="bg-primary w-12 h-12 rounded-full flex items-center justify-center text-white shadow-lg -mt-10 border-4 border-white cursor-pointer">
            <i class="fa-solid fa-plus text-xl"></i>
        </div>
        <button onclick="switchTab('shop')" class="nav-item flex flex-col items-center text-gray-400">
            <i class="fa-solid fa-bag-shopping text-xl mb-1"></i>
            <span class="text-[10px] font-bold">SHOP</span>
        </button>
    </nav>

    <div id="addModal" class="modal" onclick="closeAddModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modalFormContainer">
                </div>
        </div>
    </div>

    <script>
        // --- è³‡æ–™åˆå§‹åŒ– ---
        let currentTab = 'plan';
        let selectedDate = '2/17';
        const dates = ['2/17', '2/18', '2/19', '2/20', '2/21'];
        const weekDays = ['äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

        let tripData = JSON.parse(localStorage.getItem('busanTripData_v2')) || {
            plans: {},
            wallets: {},
            shops: { 'é£Ÿç‰©': [], 'è³¼ç‰©': [], 'ç¾å¦': [], 'äº¤é€š': [], 'å…¶ä»–': [] },
            memos: []
        };

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šå„²å­˜èˆ‡æ¸²æŸ“ ---
        function saveData() {
            localStorage.setItem('busanTripData_v2', JSON.stringify(tripData));
            render();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(item => {
                const isActive = item.getAttribute('onclick').includes(tab);
                item.classList.toggle('text-[#8ABDBF]', isActive);
                item.classList.toggle('text-gray-400', !isActive);
            });
            render();
        }

        function render() {
            const container = document.getElementById('mainContent');
            container.innerHTML = '';

            if (currentTab === 'plan') renderPlan(container);
            else if (currentTab === 'wallet') renderWallet(container);
            else if (currentTab === 'shop') renderShop(container);
        }

        // --- PLAN é é¢ ---
        function renderPlan(container) {
            const dayPlans = tripData.plans[selectedDate] || [];
            let html = `<div class="space-y-4">`;
            dayPlans.forEach((plan, idx) => {
                html += `
                    <div class="card p-4 flex gap-4 items-center relative">
                        <div class="text-primary font-bold text-sm w-12">${plan.time}</div>
                        <div class="flex-1">
                            <div class="font-bold">${plan.title}</div>
                            <div class="text-xs text-gray-400">${plan.memo || ''}</div>
                        </div>
                        <button onclick="deleteItem('plans', '${selectedDate}', ${idx})" class="text-gray-300"><i class="fa-solid fa-xmark"></i></button>
                    </div>`;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        // --- WALLET é é¢ (å«åŒ¯ç‡èˆ‡å‚™è¨») ---
        function renderWallet(container) {
            const logs = tripData.wallets[selectedDate] || [];
            let totalKRW = logs.reduce((sum, log) => sum + Number(log.amount), 0);
            let totalTWD = Math.round(totalKRW * 0.024);

            let html = `
                <div class="bg-[#8ABDBF] rounded-[30px] p-6 text-white mb-6 shadow-inner text-center">
                    <p class="text-[10px] opacity-80 mb-1 tracking-widest">TOTAL SPENT</p>
                    <h2 class="text-3xl font-bold mb-1">â‚© ${totalKRW.toLocaleString()}</h2>
                    <p class="text-sm opacity-90">â‰ˆ NT$ ${totalTWD.toLocaleString()}</p>
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-white/50 p-3 rounded-2xl text-center border border-white">
                        <p class="text-[10px] text-gray-400">å¤§æ¯”</p>
                        <p class="font-bold text-primary">â‚© ${logs.filter(l => l.payer === 'å¤§æ¯”').reduce((s, l) => s + Number(l.amount), 0).toLocaleString()}</p>
                    </div>
                    <div class="bg-white/50 p-3 rounded-2xl text-center border border-white">
                        <p class="text-[10px] text-gray-400">å°æ¯”</p>
                        <p class="font-bold text-primary">â‚© ${logs.filter(l => l.payer === 'å°æ¯”').reduce((s, l) => s + Number(l.amount), 0).toLocaleString()}</p>
                    </div>
                </div>

                <div class="space-y-3">`;
            
            logs.forEach((log, idx) => {
                html += `
                    <div class="card p-4 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-primary">
                                <i class="fa-solid ${log.type === 'CARD' ? 'fa-credit-card' : 'fa-money-bill-1'}"></i>
                            </div>
                            <div>
                                <div class="font-bold text-sm">${log.title}</div>
                                <div class="text-[10px] text-gray-400">${log.category} Â· ${log.payer} Â· ${log.type}</div>
                                ${log.memo ? `<div class="text-[10px] text-orange-400 mt-1 italic font-medium">è¨»ï¼š${log.memo}</div>` : ''}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-sm text-slate-700">â‚© ${Number(log.amount).toLocaleString()}</div>
                            <button onclick="deleteItem('wallets', '${selectedDate}', ${idx})" class="text-gray-300 text-xs mt-1"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                    </div>`;
            });

            html += `</div>
                <div class="mt-8 bg-white p-5 rounded-[24px]">
                    <p class="text-[10px] text-gray-400 mb-3 font-bold tracking-tighter uppercase">Real-time Currency</p>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center bg-slate-50 p-3 rounded-xl">
                            <span class="text-xs font-bold text-slate-400">KRW</span>
                            <input type="number" id="calcKRW" placeholder="è¼¸å…¥éŸ“å…ƒ" class="bg-transparent text-right font-bold w-full outline-none" oninput="convertCurrency('KRW')">
                        </div>
                        <div class="flex justify-center text-gray-300"><i class="fa-solid fa-arrows-rotate"></i></div>
                        <div class="flex justify-between items-center bg-slate-50 p-3 rounded-xl">
                            <span class="text-xs font-bold text-slate-400">TWD</span>
                            <input type="number" id="calcTWD" placeholder="è¼¸å…¥å°å¹£" class="bg-transparent text-right font-bold w-full outline-none" oninput="convertCurrency('TWD')">
                        </div>
                    </div>
                </div>`;
            container.innerHTML = html;
        }

        // --- SHOP é é¢ (ä¿®æ­£åœ–ç‰‡æ¯”ä¾‹èˆ‡è£œå›å‚™è¨») ---
        function renderShop(container) {
            let html = `<div class="space-y-4">`;
            for (let cat in tripData.shops) {
                html += `
                    <div class="bg-white rounded-2xl overflow-hidden shadow-sm">
                        <button onclick="this.nextElementSibling.classList.toggle('hidden')" class="w-full p-4 flex justify-between items-center font-bold text-sm border-b border-gray-50">
                            <span>${cat} (${tripData.shops[cat].length})</span>
                            <i class="fa-solid fa-chevron-down text-gray-300 text-xs"></i>
                        </button>
                        <div class="hidden p-4 grid grid-cols-2 gap-4 bg-gray-50/50">`;
                
                tripData.shops[cat].forEach((item, idx) => {
                    html += `
                        <div class="bg-white p-2 rounded-2xl shadow-sm relative">
                            ${item.img ? `<img src="${item.img}" class="shop-img mb-2">` : `<div class="shop-img bg-slate-100 flex items-center justify-center mb-2"><i class="fa-solid fa-image text-gray-300"></i></div>`}
                            <div class="px-1">
                                <div class="font-bold text-xs truncate">${item.name}</div>
                                <div class="text-[10px] text-primary">â‚© ${Number(item.price).toLocaleString()}</div>
                                ${item.memo ? `<div class="text-[9px] text-gray-400 mt-1 bg-slate-50 p-1 rounded italic">${item.memo}</div>` : ''}
                            </div>
                            <button onclick="deleteShopItem('${cat}', ${idx})" class="absolute top-1 right-1 bg-black/20 text-white w-5 h-5 rounded-full text-[10px]"><i class="fa-solid fa-xmark"></i></button>
                        </div>`;
                });

                html += `</div></div>`;
            }
            
            // MEMO Section
            html += `<div class="mt-8"><p class="font-bold mb-4 text-slate-400 tracking-widest text-xs">MEMO</p>`;
            tripData.memos.forEach((memo, idx) => {
                html += `
                    <div class="card p-4 mb-3 relative group">
                        <div class="text-[10px] font-bold text-primary mb-1">${memo.tag}</div>
                        <div class="text-sm whitespace-pre-wrap leading-relaxed">${memo.content}</div>
                        <button onclick="deleteMemo(${idx})" class="absolute top-4 right-4 text-gray-200 group-hover:text-red-300 transition-colors"><i class="fa-solid fa-xmark"></i></button>
                    </div>`;
            });
            html += `</div></div>`;
            container.innerHTML = html;
        }

        // --- è¼”åŠ©åŠŸèƒ½ ---
        function convertCurrency(type) {
            const krwIn = document.getElementById('calcKRW');
            const twdIn = document.getElementById('calcTWD');
            if(type === 'KRW') twdIn.value = Math.round(krwIn.value * 0.024);
            else krwIn.value = Math.round(twdIn.value / 0.024);
        }

        function deleteItem(type, date, idx) {
            if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
                tripData[type][date].splice(idx, 1);
                saveData();
            }
        }

        function deleteShopItem(cat, idx) {
            if(confirm('è¦ç§»å‡ºæ¸…å–®å—ï¼Ÿ')) {
                tripData.shops[cat].splice(idx, 1);
                saveData();
            }
        }

        function deleteMemo(idx) {
            if(confirm('ç¢ºå®šåˆªé™¤é€™æ¢å‚™å¿˜éŒ„ï¼Ÿ')) {
                tripData.memos.splice(idx, 1);
                saveData();
            }
        }

        // --- Modal æ§åˆ¶èˆ‡è¡¨å–®è™•ç† ---
        function openAddModal() {
            const formContainer = document.getElementById('modalFormContainer');
            if (currentTab === 'plan') {
                formContainer.innerHTML = `
                    <h3 class="font-bold mb-4">æ–°å¢è¡Œç¨‹ ğŸ“</h3>
                    <input type="time" id="planTime" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none" value="12:00">
                    <input type="text" id="planTitle" placeholder="è¦å»å“ªè£¡ï¼Ÿ" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                    <input type="text" id="planMemo" placeholder="å‚™è¨» (é¸å¡«)" class="w-full p-3 bg-gray-100 rounded-xl mb-6 outline-none">
                    <button onclick="saveNewPlan()" class="w-full py-4 bg-[#8ABDBF] text-white rounded-xl font-bold">å„²å­˜è¡Œç¨‹</button>`;
            } else if (currentTab === 'wallet') {
                formContainer.innerHTML = `
                    <h3 class="font-bold mb-4">æ–°å¢æ”¯å‡º ğŸ’°</h3>
                    <input type="text" id="payTitle" placeholder="é …ç›®åç¨±" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                    <input type="number" id="payAmount" placeholder="é‡‘é¡ (KRW)" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                    <select id="payCat" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                        <option>é£Ÿç‰©</option><option>è³¼ç‰©</option><option>ç¾å¦</option><option>äº¤é€š</option><option>å…¶ä»–</option>
                    </select>
                    <div class="flex gap-2 mb-3">
                        <select id="payPayer" class="flex-1 p-3 bg-gray-100 rounded-xl outline-none"><option>å¤§æ¯”</option><option>å°æ¯”</option></select>
                        <select id="payType" class="flex-1 p-3 bg-gray-100 rounded-xl outline-none"><option>CASH</option><option>CARD</option></select>
                    </div>
                    <input type="text" id="payMemo" placeholder="å‚™è¨» (æœƒé¡¯ç¤ºåœ¨æ¸…å–®ä¸­)" class="w-full p-3 bg-gray-100 rounded-xl mb-6 outline-none">
                    <button onclick="saveNewPay()" class="w-full py-4 bg-[#8ABDBF] text-white rounded-xl font-bold">å„²å­˜è¨˜å¸³</button>`;
            } else {
                formContainer.innerHTML = `
                    <div class="border-b mb-6 pb-2 flex gap-4">
                        <button onclick="toggleShopForm('item')" id="btnShopItem" class="font-bold text-primary">ç·¨è¼¯æ¸…å–® ğŸ›ï¸</button>
                        <button onclick="toggleShopForm('memo')" id="btnShopMemo" class="font-bold text-gray-300">ç·¨è¼¯å‚™å¿˜éŒ„ âœï¸</button>
                    </div>
                    <div id="shopItemForm">
                        <input type="text" id="shopName" placeholder="æƒ³è²·ä»€éº¼ï¼Ÿ" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                        <input type="number" id="shopPrice" placeholder="é ä¼°é‡‘é¡ (KRW)" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                        <select id="shopCat" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                            <option>é£Ÿç‰©</option><option>è³¼ç‰©</option><option>ç¾å¦</option><option>äº¤é€š</option><option>å…¶ä»–</option>
                        </select>
                        <input type="text" id="shopMemo" placeholder="å‚™è¨» (é¸å¡«)" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none">
                        <div class="w-full h-12 border-2 border-dashed border-gray-200 rounded-xl flex items-center justify-center mb-6 relative">
                            <span class="text-xs text-gray-400"><i class="fa-solid fa-camera mr-2"></i>ä¸Šå‚³åœ–ç‰‡</span>
                            <input type="file" id="shopImg" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" onchange="handleImgUpload(this)">
                        </div>
                        <button onclick="saveNewShopItem()" class="w-full py-4 bg-[#8ABDBF] text-white rounded-xl font-bold">å„²å­˜é …ç›®</button>
                    </div>
                    <div id="shopMemoForm" class="hidden">
                        <textarea id="memoContent" placeholder="å…§å®¹ (ç¶²å€æœƒè‡ªå‹•è½‰æ›)" class="w-full p-3 bg-gray-100 rounded-xl mb-3 outline-none h-32"></textarea>
                        <input type="text" id="memoTag" placeholder="æ¨™ç±¤ (ä¾‹å¦‚: é‡è¦)" class="w-full p-3 bg-gray-100 rounded-xl mb-6 outline-none">
                        <button onclick="saveNewMemo()" class="w-full py-4 bg-[#8ABDBF] text-white rounded-xl font-bold">å„²å­˜ MEMO</button>
                    </div>`;
            }
            document.getElementById('addModal').classList.add('active');
        }

        function closeAddModal(e) {
            document.getElementById('addModal').classList.remove('active');
            tempImg = null;
        }

        // --- å„²å­˜å‹•ä½œ ---
        function saveNewPlan() {
            const time = document.getElementById('planTime').value;
            const title = document.getElementById('planTitle').value;
            const memo = document.getElementById('planMemo').value;
            if(!title) return alert('è«‹è¼¸å…¥è¡Œç¨‹åç¨±');
            if(!tripData.plans[selectedDate]) tripData.plans[selectedDate] = [];
            tripData.plans[selectedDate].push({ time, title, memo });
            tripData.plans[selectedDate].sort((a,b) => a.time.localeCompare(b.time));
            saveData(); closeAddModal();
        }

        function saveNewPay() {
            const title = document.getElementById('payTitle').value;
            const amount = document.getElementById('payAmount').value;
            const category = document.getElementById('payCat').value;
            const payer = document.getElementById('payPayer').value;
            const type = document.getElementById('payType').value;
            const memo = document.getElementById('payMemo').value;
            if(!title || !amount) return alert('è«‹å®Œæ•´è¼¸å…¥');
            if(!tripData.wallets[selectedDate]) tripData.wallets[selectedDate] = [];
            tripData.wallets[selectedDate].push({ title, amount, category, payer, type, memo });
            saveData(); closeAddModal();
        }

        let tempImg = null;
        function handleImgUpload(input) {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (e) => tempImg = e.target.result;
                reader.readAsDataURL(file);
                input.previousElementSibling.innerText = "âœ… åœ–ç‰‡å·²å°±ç·’";
            }
        }

        function saveNewShopItem() {
            const name = document.getElementById('shopName').value;
            const price = document.getElementById('shopPrice').value;
            const cat = document.getElementById('shopCat').value;
            const memo = document.getElementById('shopMemo').value;
            if(!name) return alert('è«‹è¼¸å…¥åç¨±');
            tripData.shops[cat].push({ name, price, img: tempImg, memo });
            saveData(); closeAddModal();
        }

        function saveNewMemo() {
            const content = document.getElementById('memoContent').value;
            const tag = document.getElementById('memoTag').value || 'ä¸€èˆ¬';
            if(!content) return alert('è«‹è¼¸å…¥å…§å®¹');
            tripData.memos.push({ content, tag });
            saveData(); closeAddModal();
        }

        function toggleShopForm(type) {
            document.getElementById('shopItemForm').classList.toggle('hidden', type === 'memo');
            document.getElementById('shopMemoForm').classList.toggle('hidden', type === 'item');
            document.getElementById('btnShopItem').className = type === 'item' ? 'font-bold text-primary' : 'font-bold text-gray-300';
            document.getElementById('btnShopMemo').className = type === 'memo' ? 'font-bold text-primary' : 'font-bold text-gray-300';
        }

        // --- åˆå§‹åŒ–æ—¥æœŸæŒ‰éˆ• ---
        const dateTabs = document.getElementById('dateTabs');
        dates.forEach((date, i) => {
            const btn = document.createElement('button');
            btn.className = `date-btn min-w-[65px] p-3 rounded-2xl flex flex-col items-center ${date === selectedDate ? 'active' : ''}`;
            btn.innerHTML = `<span class="text-[10px] opacity-60 mb-1">${date}</span><span class="font-bold">${weekDays[i]}</span>`;
            btn.onclick = () => {
                selectedDate = date;
                document.querySelectorAll('.date-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                render();
            };
            dateTabs.appendChild(btn);
        });

        // å•Ÿå‹•æ¸²æŸ“
        switchTab('plan');
    </script>
</body>
</html>

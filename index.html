<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Busan Trip - Bibi</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #f0f4f4; }
        .teal-theme { background-color: #78B7BB; }
        .teal-text { color: #78B7BB; }
        .active-tab { color: #78B7BB !important; font-weight: bold; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .day-card { min-width: 70px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; transition: 0.3s; flex-shrink: 0; }
        .input-round { border-radius: 12px; border: 1px solid #e2e8f0; padding: 8px 12px; outline: none; }
        .btn-round { border-radius: 50px; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen pb-24 relative bg-white shadow-2xl overflow-hidden">
        
        <header id="capture-area" class="teal-theme pt-8 pb-6 px-4 text-white rounded-b-[40px] shadow-lg">
            <h1 class="text-center text-xl font-bold tracking-widest mb-4">BUSAN TRIP âš“ï¸</h1>
            <div class="flex justify-center items-center gap-3 overflow-x-auto no-scrollbar px-4">
                <div v-for="d in 5" :key="d" 
                     @click="selectedDay = d"
                     :class="selectedDay === d ? 'bg-white text-teal-600 shadow-md' : 'bg-white/30 text-white'"
                     class="day-card cursor-pointer text-sm font-bold">
                    Day {{d}}
                </div>
            </div>
        </header>

        <main class="p-5">
            <div v-if="activeTab === 'itinerary'" class="space-y-4">
                <div class="flex justify-between items-center px-1">
                    <h2 class="font-bold text-gray-600 text-lg">Daily Schedule</h2>
                    <span class="text-xs bg-teal-50 teal-text px-3 py-1 rounded-full border border-teal-100">é‡œå±± 12Â°C â˜€ï¸</span>
                </div>

                <div v-for="(item, index) in itinerary[selectedDay]" :key="index" 
                     @click="openEditModal(index)"
                     class="bg-white p-4 rounded-[24px] border border-gray-100 shadow-sm relative active:scale-[0.98] transition-transform">
                    <div class="flex justify-between items-start">
                        <span class="text-xs font-bold px-2 py-1 bg-gray-50 rounded-lg text-gray-500">{{item.time}}</span>
                        <div class="flex items-center gap-3">
                            <div class="flex items-center text-[10px] text-gray-400">
                                <i class="far fa-clock mr-1"></i>{{item.stayTime}}{{item.stayUnit}}
                            </div>
                            <button @click.stop="deleteItem(index)" class="text-gray-300 hover:text-red-400 transition-colors"><i class="fas fa-trash-alt text-xs"></i></button>
                        </div>
                    </div>
                    <h3 class="font-bold text-gray-800 text-md mt-2">{{item.place}}</h3>
                    <p class="text-xs text-gray-400 mt-1 leading-relaxed">{{item.note}}</p>
                    
                    <div class="mt-4 flex items-center justify-between border-t pt-3 border-gray-50">
                        <div class="flex items-center text-[11px] text-gray-500 bg-gray-50 px-2 py-1 rounded-md">
                            <i :class="getTransportIcon(item.transport)" class="mr-1 teal-text"></i>
                            <span>{{item.travelTime}}{{item.travelUnit}}</span>
                        </div>
                        <a v-if="item.mapUrl" :href="item.mapUrl" target="_blank" @click.stop 
                           class="w-8 h-8 flex items-center justify-center bg-teal-50 rounded-full teal-text">
                            <i class="fas fa-location-arrow text-sm"></i>
                        </a>
                    </div>
                </div>

                <button @click="openAddModal" class="w-full py-4 border-2 border-dashed border-teal-100 rounded-[24px] text-teal-300 font-medium">
                    <i class="fas fa-plus-circle mr-2"></i>æ–°å¢è¡Œç¨‹
                </button>
            </div>

            <div v-if="activeTab === 'wallet'" class="space-y-5">
                <div class="bg-gradient-to-br from-[#78B7BB] to-[#95d1d5] p-6 rounded-[32px] text-white shadow-inner">
                    <p class="text-xs opacity-80 mb-1 text-center">ç¸½æ”¯å‡º (KRW)</p>
                    <h2 class="text-3xl font-bold text-center">â‚© {{totalSpent.toLocaleString()}}</h2>
                    <p class="text-[10px] text-center mt-2 bg-white/20 inline-block px-3 py-1 rounded-full mx-auto block w-fit">ç´„ TWD {{Math.round(totalSpent * 0.024).toLocaleString()}} å…ƒ</p>
                </div>

                <div class="space-y-3">
                    <div v-for="(bill, index) in bills" :key="index" class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border border-gray-50">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-teal-50 flex items-center justify-center teal-text">
                                <i :class="getCategoryIcon(bill.category)"></i>
                            </div>
                            <div>
                                <p class="font-bold text-sm text-gray-700">{{bill.store}}</p>
                                <p class="text-[10px] text-gray-400">{{bill.payer}} Â· {{bill.method === 'cash' ? 'ç¾é‡‘' : 'ä¿¡ç”¨å¡'}}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-sm">â‚© {{bill.amount.toLocaleString()}}</p>
                            <p class="text-[10px] text-gray-400">NT$ {{Math.round(bill.amount * 0.024)}}</p>
                        </div>
                    </div>
                </div>
                <button @click="openBillModal" class="fixed bottom-24 right-6 w-14 h-14 teal-theme text-white rounded-full shadow-lg z-20 flex items-center justify-center text-xl">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div v-if="activeTab === 'tools'" class="space-y-6">
                <div class="bg-white p-5 rounded-[24px] shadow-sm border border-gray-50">
                    <h3 class="font-bold mb-4 teal-text text-sm"><i class="fas fa-calculator mr-2"></i>å³æ™‚åŒ¯ç‡æ›ç®—</h3>
                    <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-xl">
                        <input type="number" v-model="calcKrw" class="bg-transparent flex-1 font-bold text-lg outline-none" placeholder="è¼¸å…¥éŸ“å…ƒ">
                        <div class="text-xs font-bold text-gray-400 border-l pl-4">â‚© KRW</div>
                    </div>
                    <div class="mt-3 text-center">
                        <i class="fas fa-angle-double-down text-gray-200"></i>
                    </div>
                    <div class="flex items-center gap-4 bg-teal-50 p-3 rounded-xl mt-3">
                        <div class="flex-1 font-bold text-lg teal-text">NT$ {{Math.round(calcKrw * 0.024).toLocaleString()}}</div>
                        <div class="text-xs font-bold teal-text border-l border-teal-100 pl-4">å°å¹£ (é ä¼°)</div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-[24px] shadow-sm border border-gray-50">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold teal-text text-sm"><i class="fas fa-shopping-bag mr-2"></i>å¾…è²·æ¸…å–®</h3>
                        <button @click="openShoppingModal" class="text-xs bg-teal-50 teal-text px-2 py-1 rounded">æ–°å¢å“é …</button>
                    </div>
                    <div v-for="(item, idx) in shoppingList" :key="idx" @click="editShopping(idx)" class="flex gap-3 mb-4 last:mb-0 border-b border-gray-50 pb-3">
                        <div v-if="item.img" class="w-12 h-12 rounded-lg bg-gray-100 overflow-hidden shrink-0">
                            <img :src="item.img" class="w-full h-full object-cover">
                        </div>
                        <div v-else class="w-12 h-12 rounded-lg bg-gray-50 flex items-center justify-center shrink-0 text-gray-300">
                            <i class="fas fa-image text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <p class="text-sm font-bold">{{item.name}}</p>
                                <span class="text-[10px] teal-text">â‚©{{item.price}}</span>
                            </div>
                            <p class="text-[10px] text-gray-400">{{item.store}} <span v-if="item.model">| {{item.model}}</span></p>
                            <p class="text-[10px] text-gray-400 truncate w-40">{{item.note}}</p>
                        </div>
                    </div>
                </div>

                <button @click="exportToImg" class="w-full py-4 teal-theme text-white rounded-2xl font-bold shadow-lg active:scale-95 transition-transform">
                    <i class="fas fa-file-export mr-2"></i>åŒ¯å‡ºä»Šæ—¥è¡Œç¨‹ç‚ºåœ–ç‰‡
                </button>
            </div>
        </main>

        <div v-if="showModal" class="fixed inset-0 bg-black/60 flex items-end justify-center z-50">
            <div class="bg-white w-full rounded-t-[40px] p-8 pb-10 shadow-2xl animate-slide-up">
                <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-6"></div>
                <h3 class="font-bold mb-6 text-gray-700 flex items-center">
                    <i class="fas fa-edit mr-2 teal-text"></i> {{isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹'}}
                </h3>
                
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="col-span-2">
                        <label class="text-[10px] text-gray-400 ml-2">åœ°é»åç¨±</label>
                        <input v-model="form.place" placeholder="è¦å»å“ªè£¡ï¼Ÿ" class="w-full input-round mt-1 text-sm bg-gray-50">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 ml-2">é–‹å§‹æ™‚é–“</label>
                        <input v-model="form.time" type="time" class="w-full input-round mt-1 text-sm bg-gray-50">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 ml-2">å¾…å¤šä¹…</label>
                        <div class="flex gap-1 mt-1">
                            <input v-model="form.stayTime" class="w-12 input-round text-sm text-center bg-gray-50 px-1">
                            <select v-model="form.stayUnit" class="flex-1 input-round text-xs bg-gray-50">
                                <option value="m">min</option>
                                <option value="h">hour</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="text-[10px] text-gray-400 ml-2">åœ°åœ–ç¶²å€ (Naver/Google)</label>
                    <input v-model="form.mapUrl" placeholder="è²¼ä¸Šé€£çµï¼Œé»æ“Šå°æ¨™ç¤ºæœƒè·³è½‰" class="w-full input-round mt-1 text-xs bg-gray-50">
                </div>

                <div class="flex gap-3 mb-6">
                    <div class="w-1/3">
                        <label class="text-[10px] text-gray-400 ml-2">äº¤é€š</label>
                        <select v-model="form.transport" class="w-full input-round mt-1 text-sm bg-gray-50">
                            <option value="walk">ğŸš¶</option>
                            <option value="car">ğŸš—</option>
                            <option value="bus">ğŸšŒ</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="text-[10px] text-gray-400 ml-2">é€šè»Šæ™‚é–“</label>
                        <div class="flex gap-1 mt-1">
                            <input v-model="form.travelTime" class="flex-1 input-round text-sm bg-gray-50">
                            <select v-model="form.travelUnit" class="w-16 input-round text-xs bg-gray-50">
                                <option value="m">min</option>
                                <option value="h">hour</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="text-[10px] text-gray-400 ml-2">å‚™è¨»</label>
                    <textarea v-model="form.note" class="w-full input-round mt-1 text-sm bg-gray-50" rows="2"></textarea>
                </div>

                <div class="flex gap-4">
                    <button @click="showModal = false" class="flex-1 py-4 bg-gray-100 rounded-2xl text-gray-500 font-bold">å–æ¶ˆ</button>
                    <button @click="saveForm" class="flex-2 py-4 teal-theme text-white rounded-2xl font-bold shadow-lg w-2/3">ç¢ºå®šå„²å­˜</button>
                </div>
            </div>
        </div>

        <div v-if="showBillModal" class="fixed inset-0 bg-black/60 flex items-end z-50">
            <div class="bg-white w-full rounded-t-[40px] p-8 animate-slide-up">
                <h3 class="font-bold mb-6 text-gray-700">è¨˜ä¸€ç­†æ”¯å‡º</h3>
                <div class="space-y-4 mb-6">
                    <input v-model="billForm.store" placeholder="è³¼è²·é€šè·¯/åº—å" class="w-full input-round bg-gray-50">
                    <div class="flex gap-3">
                        <input v-model.number="billForm.amount" type="number" placeholder="é‡‘é¡ (KRW)" class="flex-1 input-round bg-gray-50">
                        <select v-model="billForm.category" class="w-24 input-round bg-gray-50 text-xs">
                            <option value="food">ğŸ´ é£Ÿç‰©</option>
                            <option value="shop">ğŸ›ï¸ è³¼ç‰©</option>
                            <option value="other">âœ¨ å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="flex gap-3">
                        <input v-model="billForm.payer" placeholder="èª°ä»˜çš„ï¼Ÿ" class="flex-1 input-round bg-gray-50">
                        <select v-model="billForm.method" class="w-24 input-round bg-gray-50 text-xs">
                            <option value="card">ğŸ’³ åˆ·å¡</option>
                            <option value="cash">ğŸ’µ ç¾é‡‘</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-4 mb-8">
                    <button @click="showBillModal = false" class="flex-1 py-4 bg-gray-100 rounded-2xl">å–æ¶ˆ</button>
                    <button @click="saveBill" class="flex-2 py-4 teal-theme text-white rounded-2xl font-bold shadow-lg w-2/3">æ–°å¢æ”¯å‡º</button>
                </div>
            </div>
        </div>

        <div v-if="showShopModal" class="fixed inset-0 bg-black/60 flex items-end z-50">
            <div class="bg-white w-full rounded-t-[40px] p-8 animate-slide-up">
                <h3 class="font-bold mb-4 text-gray-700">è³¼ç‰©æ¸…å–®å‚™å¿˜</h3>
                <div class="space-y-3 mb-6">
                    <input v-model="shopForm.name" placeholder="å“å" class="w-full input-round bg-gray-50">
                    <div class="flex gap-2">
                        <input v-model="shopForm.store" placeholder="é€šè·¯" class="flex-1 input-round bg-gray-50">
                        <input v-model="shopForm.price" placeholder="åƒ¹æ ¼" class="w-24 input-round bg-gray-50">
                    </div>
                    <input v-model="shopForm.model" placeholder="å‹è™Ÿ/è¦æ ¼ (é¸å¡«)" class="w-full input-round bg-gray-50">
                    <textarea v-model="shopForm.note" placeholder="å‚™è¨»" class="w-full input-round bg-gray-50"></textarea>
                    
                    <div class="flex items-center gap-4">
                        <button @click="$refs.fileInput.click()" class="py-2 px-4 bg-teal-50 teal-text rounded-xl text-xs">
                            <i class="fas fa-camera mr-2"></i>ä¸Šå‚³ç…§ç‰‡
                        </button>
                        <input type="file" ref="fileInput" @change="handleFileUpload" class="hidden" accept="image/*">
                        <span v-if="shopForm.img" class="text-[10px] text-green-500">å·²é¸æ“‡åœ–ç‰‡</span>
                    </div>
                </div>
                <div class="flex gap-4 mb-8">
                    <button @click="showShopModal = false" class="flex-1 py-4 bg-gray-100 rounded-2xl">å–æ¶ˆ</button>
                    <button @click="saveShopping" class="flex-2 py-4 teal-theme text-white rounded-2xl font-bold w-2/3">å„²å­˜</button>
                </div>
            </div>
        </div>

        <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-md border-t border-gray-100 flex justify-around py-4 rounded-t-3xl shadow-2xl z-30">
            <button @click="activeTab = 'itinerary'" :class="{'active-tab': activeTab === 'itinerary'}" class="flex flex-col items-center text-gray-300">
                <i class="fas fa-map-marked-alt text-xl"></i>
                <span class="text-[10px] mt-1">è¡Œç¨‹</span>
            </button>
            <button @click="activeTab = 'wallet'" :class="{'active-tab': activeTab === 'wallet'}" class="flex flex-col items-center text-gray-300">
                <i class="fas fa-wallet text-xl"></i>
                <span class="text-[10px] mt-1">è¨˜å¸³</span>
            </button>
            <button @click="activeTab = 'tools'" :class="{'active-tab': activeTab === 'tools'}" class="flex flex-col items-center text-gray-300">
                <i class="fas fa-th-large text-xl"></i>
                <span class="text-[10px] mt-1">å·¥å…·</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    activeTab: 'itinerary',
                    selectedDay: 1,
                    showModal: false,
                    showBillModal: false,
                    showShopModal: false,
                    isEditing: false,
                    editIndex: null,
                    calcKrw: null,
                    form: { time: '', place: '', note: '', transport: 'walk', travelTime: '', travelUnit: 'm', stayTime: '', stayUnit: 'h', mapUrl: '' },
                    billForm: { store: '', amount: '', category: 'food', payer: '', method: 'card' },
                    shopForm: { name: '', store: '', price: '', model: '', note: '', img: '' },
                    itinerary: JSON.parse(localStorage.getItem('busan_v2_itinerary')) || { 1: [], 2: [], 3: [], 4: [], 5: [] },
                    bills: JSON.parse(localStorage.getItem('busan_v2_bills')) || [],
                    shoppingList: JSON.parse(localStorage.getItem('busan_v2_shopping')) || []
                }
            },
            computed: {
                totalSpent() {
                    return this.bills.reduce((sum, item) => sum + Number(item.amount), 0);
                }
            },
            watch: {
                itinerary: { handler(val) { localStorage.setItem('busan_v2_itinerary', JSON.stringify(val)) }, deep: true },
                bills: { handler(val) { localStorage.setItem('busan_v2_bills', JSON.stringify(val)) }, deep: true },
                shoppingList: { handler(val) { localStorage.setItem('busan_v2_shopping', JSON.stringify(val)) }, deep: true }
            },
            methods: {
                getTransportIcon(t) {
                    return t === 'walk' ? 'fas fa-walking' : (t === 'car' ? 'fas fa-car' : 'fas fa-bus');
                },
                getCategoryIcon(c) {
                    const icons = { food: 'fas fa-utensils', shop: 'fas fa-shopping-bag', other: 'fas fa-ellipsis-h' };
                    return icons[c] || icons.other;
                },
                openAddModal() {
                    this.isEditing = false;
                    this.form = { time: '09:00', place: '', note: '', transport: 'walk', travelTime: '15', travelUnit: 'm', stayTime: '1', stayUnit: 'h', mapUrl: '' };
                    this.showModal = true;
                },
                openEditModal(index) {
                    this.isEditing = true;
                    this.editIndex = index;
                    this.form = { ...this.itinerary[this.selectedDay][index] };
                    this.showModal = true;
                },
                saveForm() {
                    if(!this.form.place) return alert('è«‹è¼¸å…¥åœ°é»åç¨±');
                    if(this.isEditing) {
                        this.itinerary[this.selectedDay][this.editIndex] = { ...this.form };
                    } else {
                        this.itinerary[this.selectedDay].push({ ...this.form });
                        this.itinerary[this.selectedDay].sort((a, b) => a.time.localeCompare(b.time));
                    }
                    this.showModal = false;
                },
                deleteItem(index) {
                    if(confirm('ç¢ºå®šåˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) this.itinerary[this.selectedDay].splice(index, 1);
                },
                openBillModal() {
                    this.billForm = { store: '', amount: '', category: 'food', payer: 'Bibi', method: 'card' };
                    this.showBillModal = true;
                },
                saveBill() {
                    if(!this.billForm.amount) return alert('è«‹è¼¸å…¥é‡‘é¡');
                    this.bills.unshift({ ...this.billForm });
                    this.showBillModal = false;
                },
                openShoppingModal() {
                    this.shopForm = { name: '', store: '', price: '', model: '', note: '', img: '' };
                    this.showShopModal = true;
                },
                handleFileUpload(e) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => { this.shopForm.img = event.target.result; };
                    reader.readAsDataURL(file);
                },
                saveShopping() {
                    this.shoppingList.push({ ...this.shopForm });
                    this.showShopModal = false;
                },
                exportToImg() {
                    const el = document.getElementById('app');
                    html2canvas(el, { useCORS: true, scale: 2 }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `Busan_Day${this.selectedDay}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                    });
                }
            }
        }).mount('#app')
    </script>
    <style>
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .animate-slide-up { animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</body>
</html>

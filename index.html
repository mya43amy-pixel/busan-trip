<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 Busan - Bibi Ultimate v3</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #f8fbfb; -webkit-tap-highlight-color: transparent; }
        .teal-theme { background-color: #78B7BB; }
        .teal-text { color: #78B7BB; }
        .active-tab { color: #78B7BB !important; font-weight: bold; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Header æ—¥æœŸæ¡†å„ªåŒ–ï¼šå¯¬åº¦è¶³å¤ ï¼Œä¸åˆ‡é‚Š */
        header { padding-top: 2.5rem; padding-bottom: 2rem; overflow: hidden; }
        .day-btn { min-width: 65px; height: 75px; border-radius: 20px; transition: all 0.3s; flex-shrink: 0; }

        .main-container {
            background: white;
            border-radius: 40px 40px 0 0;
            min-height: 85vh;
            padding: 30px 20px 140px;
            margin-top: -25px;
            position: relative;
            z-index: 10;
        }

        .card-pop { border-radius: 24px; background: white; box-shadow: 0 4px 18px rgba(120, 183, 187, 0.08); border: 1px solid #fcfdfd; }
        .input-round { border-radius: 14px; border: 1px solid #f0f4f4; padding: 14px; width: 100%; outline: none; background: #f9fbfb; font-size: 15px; }
        
        /* è¨˜å¸³åˆ‡æ›æŒ‰éˆ• */
        .toggle-btn { flex: 1; padding: 12px; text-align: center; border-radius: 14px; background: #f3f7f7; color: #ccc; font-weight: bold; cursor: pointer; }
        .toggle-btn.active { background: #78B7BB; color: white; }
        .income-active { background: #A8D5BA !important; color: white !important; }

        .method-btn { width: 48%; border-radius: 12px; background: #f3f7f7; color: #d1dada; text-align: center; padding: 10px 0; }
        .method-btn.active { background: #78B7BB; color: white; }

        /* äº¤é€šå·¥å…·è¤‡é¸æ¨£å¼ */
        .trans-opt { width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: #f3f7f7; color: #d1dada; transition: 0.2s; }
        .trans-opt.active { background: #78B7BB; color: white; transform: scale(1.1); }

        /* è³¼ç‰©æ¸…å–®ç½®åº•æ¨£å¼ */
        .bought-style { opacity: 0.4; filter: grayscale(0.8); order: 99; }
        .cat-grid { display: flex; flex-direction: column; } /* è®“ order ç”Ÿæ•ˆ */

        [v-cloak] { display: none; }
    </style>
</head>
<body>
    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-[#f8fbfb]">
        
        <header class="teal-theme text-white text-center">
            <h1 class="text-sm font-black tracking-[0.4em] mb-7 uppercase">2026 BUSAN</h1>
            <div class="flex justify-start gap-3 px-6 overflow-x-auto no-scrollbar">
                <div v-for="(d, i) in dateConfig" :key="i" @click="selectedDay = (i+1)"
                    :class="selectedDay === (i+1) ? 'bg-white text-[#78B7BB] shadow-xl scale-105' : 'bg-white/20 text-white'"
                    class="day-btn flex flex-col items-center justify-center cursor-pointer">
                    <span class="text-xl font-black">{{d.date.split('/')[1]}}</span>
                    <span class="text-[10px] font-bold opacity-70">{{d.day}}</span>
                </div>
            </div>
        </header>

        <main class="main-container">
            <div v-show="activeTab === 'itinerary'" class="space-y-6">
                <div v-for="(item, idx) in sortedItinerary" :key="idx" @click="openEditModal(item.originalIndex)" class="card-pop p-6 relative mb-5">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-[11px] font-black px-2.5 py-1 bg-teal-50 teal-text rounded-lg">{{item.time}}</span>
                        <div class="flex gap-1.5 ml-1">
                            <i v-for="t in getTransList(item.transport)" :key="t" :class="getTransIcon(t)" class="text-gray-300 text-[11px]"></i>
                        </div>
                        <span v-if="item.stayTime" class="text-[10px] text-gray-400 font-bold uppercase ml-auto">åœç•™ {{item.stayTime}}{{item.stayUnit}}</span>
                    </div>
                    <h3 class="font-bold text-gray-800 text-[18px] mb-1">{{item.place}}</h3>
                    <p v-if="item.note" class="text-[13px] text-gray-400 leading-relaxed whitespace-pre-wrap">{{item.note}}</p>
                    <a v-if="item.mapUrl" :href="item.mapUrl" target="_blank" @click.stop class="absolute top-6 right-6 text-teal-200"><i class="fas fa-location-arrow"></i></a>
                </div>
                <button @click="openAddModal" class="w-full py-5 border-2 border-dashed border-teal-50 rounded-[28px] text-teal-200 font-black text-[11px] tracking-widest uppercase">+ æ–°å¢è¡Œç¨‹</button>
            </div>

            <div v-show="activeTab === 'wallet'" class="space-y-6">
                <div class="teal-theme p-7 rounded-[35px] text-white shadow-2xl">
                    <div class="flex flex-col items-center mb-6">
                        <p class="text-[9px] opacity-60 tracking-[0.2em] uppercase mb-1">ç¸½æ”¯å‡ºé ç®—</p>
                        <h2 class="text-4xl font-black">â‚© {{totalExpense.toLocaleString()}}</h2>
                        <p class="text-xs opacity-80 mt-1 font-bold">â‰ˆ NT$ {{Math.round(totalExpense * rate).toLocaleString()}}</p>
                    </div>

                    <div @click="setInitialCash" class="bg-black/10 p-5 rounded-2xl mb-4 text-center cursor-pointer">
                        <p class="text-[10px] opacity-70 mb-1">ğŸ’° å‰©é¤˜ç¾é‡‘</p>
                        <h3 class="text-xl font-black">â‚© {{remainingCash.toLocaleString()}}</h3>
                        <p class="text-[9px] opacity-50 mt-1">åˆå§‹ç¾é‡‘: â‚© {{initialCash.toLocaleString()}}</p>
                    </div>

                    <div class="grid grid-cols-3 gap-2 text-center border-t border-white/20 pt-5">
                        <div v-for="m in members" :key="m">
                            <p class="text-[10px] opacity-60 mb-1">{{m}}</p>
                            <p class="font-black text-[12px]">â‚© {{getMemberTotal(m).toLocaleString()}}</p>
                            <p class="text-[9px] opacity-50 font-bold">NT$ {{Math.round(getMemberTotal(m) * rate).toLocaleString()}}</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div v-for="(bill, idx) in bills" :key="idx" @click="editBill(idx)" class="card-pop p-5 flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-11 h-11 rounded-2xl flex items-center justify-center text-lg" :class="bill.type === 'æ”¶å…¥' ? 'bg-green-50 text-green-400' : 'bg-gray-50 text-gray-400'">
                                <i :class="bill.method === 'ç¾é‡‘' ? 'fas fa-coins' : 'fas fa-credit-card'"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800 text-[15px]">{{bill.itemName}}</p>
                                <p class="text-[10px] text-gray-400 font-bold">{{bill.payer}} Â· {{bill.category}}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-black text-[16px]" :class="bill.type === 'æ”¶å…¥' ? 'text-green-500' : 'text-gray-800'">
                                {{bill.type === 'æ”¶å…¥' ? '+' : '-'}} â‚© {{Number(bill.amount).toLocaleString()}}
                            </p>
                            <p class="text-[10px] text-gray-300 font-bold">NT$ {{Math.round(bill.amount * rate).toLocaleString()}}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div v-show="activeTab === 'tools'" class="space-y-8">
                <div class="bg-teal-50/50 p-6 rounded-[30px] flex items-center gap-4">
                    <div class="flex-1"><p class="text-[10px] font-black teal-text mb-1 uppercase">éŸ“å…ƒ KRW</p><input type="number" v-model="calcKrw" class="bg-transparent text-xl font-black teal-text w-full outline-none" placeholder="0"></div>
                    <i class="fas fa-exchange-alt text-teal-200"></i>
                    <div class="flex-1 text-right"><p class="text-[10px] font-black text-gray-300 mb-1 uppercase">å°å¹£ TWD</p><p class="text-xl font-black text-gray-400">â‰ˆ {{Math.round(calcKrw * rate)}}</p></div>
                </div>

                <div v-for="cat in categories" :key="cat">
                    <h3 class="font-black text-gray-700 text-[11px] mb-4 px-1 tracking-widest uppercase">{{cat}} ({{getCatCount(cat)}})</h3>
                    <div class="grid grid-cols-2 gap-4 cat-grid">
                        <div v-for="item in getSortedShopItems(cat)" :key="item.id" @click="editShopItem(item.id)" 
                            class="card-pop overflow-hidden relative" :class="{'bought-style': item.isBought}">
                            <div class="aspect-square bg-gray-50">
                                <img v-if="item.imgBase64" :src="item.imgBase64" class="w-full h-full object-cover">
                                <div v-else class="w-full h-full flex items-center justify-center text-gray-100 text-3xl"><i class="fas fa-shopping-bag"></i></div>
                            </div>
                            <div class="p-4">
                                <h4 class="font-bold text-[13px] text-gray-700 truncate mb-1">{{item.name}}</h4>
                                <p class="teal-text font-black text-[14px]">â‚© {{Number(item.price).toLocaleString()}}</p>
                                <p v-if="item.note" class="text-[10px] text-gray-400 mt-2 truncate">{{item.note}}</p>
                            </div>
                            <button @click.stop="toggleBought(item.id)" class="absolute top-3 right-3 w-8 h-8 rounded-full shadow-md flex items-center justify-center" :class="item.isBought ? 'bg-green-400 text-white' : 'bg-white text-gray-200'">
                                <i class="fas fa-check text-[10px]"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button @click="openShopModal" class="w-full py-5 border-2 border-dashed border-teal-50 rounded-[28px] text-teal-200 font-black text-[11px] tracking-widest uppercase">+ æ–°å¢ç‰©å“</button>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/95 backdrop-blur-md border-t border-gray-50 flex justify-around py-7 rounded-t-[45px] z-[100] shadow-2xl">
            <button @click="activeTab = 'itinerary'" :class="{'active-tab': activeTab === 'itinerary'}" class="flex flex-col items-center text-gray-200"><i class="fas fa-calendar-day text-[22px]"></i><span class="text-[10px] mt-2 font-black uppercase">è¡Œç¨‹</span></button>
            <button @click="activeTab = 'wallet'" :class="{'active-tab': activeTab === 'wallet'}" class="flex flex-col items-center text-gray-200"><i class="fas fa-wallet text-[22px]"></i><span class="text-[10px] mt-2 font-black uppercase">è¨˜å¸³</span></button>
            <button @click="activeTab = 'tools'" :class="{'active-tab': activeTab === 'tools'}" class="flex flex-col items-center text-gray-200"><i class="fas fa-shopping-bag text-[22px]"></i><span class="text-[10px] mt-2 font-black uppercase">æ¸…å–®</span></button>
        </nav>

        <div v-if="showModal" class="fixed inset-0 bg-black/70 z-[1000] flex items-end">
            <div class="bg-white w-full rounded-t-[45px] p-8 max-h-[90vh] overflow-y-auto pb-12">
                <div class="flex justify-between mb-8"><h3 class="text-xl font-black">è¡Œç¨‹ç´°ç¯€</h3><button @click="showModal = false" class="text-gray-300 text-2xl"><i class="fas fa-times"></i></button></div>
                <div class="space-y-6">
                    <div class="flex gap-4">
                        <div class="flex-1"><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">æ™‚é–“</label><input type="time" v-model="form.time" class="input-round font-black teal-text"></div>
                        <div class="flex-1"><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">åœç•™æ™‚é–“</label><input type="number" v-model="form.stayTime" class="input-round"></div>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-gray-400 mb-2 block uppercase">äº¤é€šæ–¹å¼ (å¯è¤‡é¸)</label>
                        <div class="flex gap-3">
                            <button v-for="t in ['walk','bus','subway','taxi']" :key="t" @click="toggleTrans(t)" :class="{'active': isTransSelected(t)}" class="trans-opt"><i :class="getTransIcon(t)"></i></button>
                        </div>
                    </div>
                    <div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">åœ°é»</label><input v-model="form.place" class="input-round font-bold"></div>
                    <div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">åœ°åœ–é€£çµ (Map URL)</label><input v-model="form.mapUrl" class="input-round text-xs"></div>
                    <div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">å‚™è¨» (MEMO)</label><textarea v-model="form.note" class="input-round h-24 text-sm"></textarea></div>
                    <div class="flex gap-4 pt-4"><button v-if="isEditing" @click="deleteItem" class="flex-1 py-4 bg-red-50 text-red-400 rounded-2xl font-black">åˆªé™¤</button><button @click="saveForm" class="flex-[2] py-4 teal-theme text-white rounded-2xl font-black shadow-lg">å„²å­˜è¡Œç¨‹</button></div>
                </div>
            </div>
        </div>

        <div v-if="showBillModal" class="fixed inset-0 bg-black/70 z-[1200] flex items-end">
            <div class="bg-white w-full rounded-t-[45px] p-8 max-h-[92vh] overflow-y-auto pb-12">
                <div class="flex justify-between mb-8"><h3 class="text-xl font-black">æ–°å¢å¸³ç›®</h3><button @click="showBillModal = false" class="text-gray-300 text-2xl"><i class="fas fa-times"></i></button></div>
                <div class="space-y-6">
                    <div class="flex gap-3"><div @click="billForm.type = 'æ”¯å‡º'" :class="{'active': billForm.type === 'æ”¯å‡º'}" class="toggle-btn">æ”¯å‡º</div><div @click="billForm.type = 'æ”¶å…¥'" :class="{'income-active active': billForm.type === 'æ”¶å…¥'}" class="toggle-btn">æ”¶å…¥</div></div>
                    <div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">é‡‘é¡ (KRW)</label><input type="number" v-model="billForm.amount" class="input-round font-black text-2xl teal-text"></div>
                    <div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">å“é …åç¨±</label><input v-model="billForm.itemName" class="input-round font-bold"></div>
                    <div class="flex gap-4">
                        <div class="flex-1"><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">æ–¹å¼</label><div class="flex gap-2"><div @click="billForm.method = 'åˆ·å¡'" :class="{'active': billForm.method === 'åˆ·å¡'}" class="method-btn cursor-pointer flex-1"><i class="fas fa-credit-card"></i></div><div @click="billForm.method = 'ç¾é‡‘'" :class="{'active': billForm.method === 'ç¾é‡‘'}" class="method-btn cursor-pointer flex-1"><i class="fas fa-coins"></i></div></div></div>
                        <div class="flex-1" v-if="billForm.type === 'æ”¯å‡º'"><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">æ—…ä¼´</label><select v-model="billForm.payer" class="input-round font-bold"><option v-for="m in members" :value="m">{{m}}</option></select></div>
                    </div>
                    <div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">å‚™è¨» (MEMO)</label><textarea v-model="billForm.note" class="input-round h-24 text-sm" placeholder="è¼¸å…¥è©³ç´°ç´€éŒ„..."></textarea></div>
                    <div class="flex gap-4 pt-4"><button v-if="isEditBill" @click="deleteBill" class="flex-1 py-4 bg-red-50 text-red-400 rounded-2xl font-black">åˆªé™¤</button><button @click="saveBill" class="flex-[2] py-4 teal-theme text-white rounded-2xl font-black shadow-lg">å„²å­˜ç´€éŒ„</button></div>
                </div>
            </div>
        </div>

        <div v-if="showShopModal" class="fixed inset-0 bg-black/70 z-[1200] flex items-end">
            <div class="bg-white w-full rounded-t-[45px] p-8 max-h-[92vh] overflow-y-auto pb-12">
                <div class="flex justify-between mb-8"><h3 class="text-xl font-black">æ¸…å–®ç·¨è¼¯</h3><button @click="showShopModal = false" class="text-gray-300 text-2xl"><i class="fas fa-times"></i></button></div>
                <div class="space-y-6">
                    <label class="mx-auto w-32 h-32 bg-gray-50 rounded-[30px] border-2 border-dashed border-gray-100 flex items-center justify-center cursor-pointer overflow-hidden mb-4"><img v-if="shopForm.imgBase64" :src="shopForm.imgBase64" class="w-full h-full object-cover"><i v-else class="fas fa-camera text-gray-200 text-3xl"></i><input type="file" @change="handleFileUpload" class="hidden" accept="image/*"></label>
                    <input v-model="shopForm.name" placeholder="å“é …åç¨±" class="input-round font-bold">
                    <div class="grid grid-cols-2 gap-4"><div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">é‡‘é¡ (KRW)</label><input v-model="shopForm.price" type="number" class="input-round teal-text font-black"></div><div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">åˆ†é¡</label><select v-model="shopForm.category" class="input-round font-bold"><option v-for="c in categories" :value="c">{{c}}</option></select></div></div>
                    <div><label class="text-[10px] font-black text-gray-400 mb-1 block uppercase">å‚™è¨» (MEMO)</label><textarea v-model="shopForm.note" class="input-round h-24 text-sm"></textarea></div>
                    <div class="flex gap-4 pt-4"><button v-if="isEditShop" @click="deleteShopItem" class="flex-1 py-4 bg-red-50 text-red-400 rounded-2xl font-black">åˆªé™¤</button><button @click="saveShopItem" class="flex-[2] py-4 teal-theme text-white rounded-2xl font-black shadow-lg">ç¢ºèªå„²å­˜</button></div>
                </div>
            </div>
        </div>

        <button v-if="activeTab === 'wallet'" @click="openBillModal" class="fixed bottom-32 right-8 w-16 h-16 teal-theme text-white rounded-full shadow-2xl flex items-center justify-center text-2xl border-4 border-white z-[110] active:scale-90"><i class="fas fa-plus"></i></button>
    </div>

    <script>
        const { createApp } = Vue;
        const firebaseConfig = { apiKey: "AIzaSyAqfcjA5QuZlDibAJlkJL7IJvj4zwxyjPM", authDomain: "busan-trip-bibi.firebaseapp.com", databaseURL: "https://busan-trip-bibi-default-rtdb.firebaseio.com", projectId: "busan-trip-bibi" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const DATA_PATH = 'busan_trip_final';

        createApp({
            data() {
                return {
                    activeTab: 'itinerary', selectedDay: 1, rate: 0.024, calcKrw: null,
                    showModal: false, showBillModal: false, showShopModal: false,
                    isEditing: false, isEditBill: false, isEditShop: false, editIndex: null,
                    dateConfig: [{date: '2/17', day: 'äºŒ'}, {date: '2/18', day: 'ä¸‰'}, {date: '2/19', day: 'å››'}, {date: '2/20', day: 'äº”'}, {date: '2/21', day: 'å…­'}],
                    itinerary: {1:[], 2:[], 3:[], 4:[], 5:[]}, bills: [], shoppingList: [], members: ['å…±åŒ', 'å¤§æ¯”', 'å°æ¯”'], categories: ['é£Ÿç‰©', 'è³¼ç‰©', 'ç¾å¦', 'å…¶ä»–'], initialCash: 0,
                    form: { time: '09:00', place: '', note: '', transport: '', stayTime: '', stayUnit: 'H', mapUrl: '' },
                    billForm: { itemName: '', amount: 0, method: 'åˆ·å¡', payer: 'å…±åŒ', category: 'é£Ÿç‰©', type: 'æ”¯å‡º', note: '' },
                    shopForm: { name: '', price: 0, category: 'è³¼ç‰©', imgBase64: '', isBought: false, id: null, note: '' }
                }
            },
            computed: {
                sortedItinerary() { return (this.itinerary[this.selectedDay] || []).map((item, index) => ({ ...item, originalIndex: index })).sort((a, b) => a.time.localeCompare(b.time)); },
                totalExpense() { return this.bills.filter(b => b.type === 'æ”¯å‡º').reduce((sum, b) => sum + Number(b.amount), 0); },
                cashSpent() { return this.bills.filter(b => b.method === 'ç¾é‡‘' && b.type === 'æ”¯å‡º').reduce((sum, b) => sum + Number(b.amount), 0); },
                cashIncome() { return this.bills.filter(b => b.method === 'ç¾é‡‘' && b.type === 'æ”¶å…¥').reduce((sum, b) => sum + Number(b.amount), 0); },
                remainingCash() { return Number(this.initialCash) - this.cashSpent + this.cashIncome; }
            },
            mounted() {
                db.ref(DATA_PATH).on('value', (s) => {
                    const data = s.val();
                    if (data) {
                        this.itinerary = data.itinerary || {1:[], 2:[], 3:[], 4:[], 5:[]};
                        this.bills = data.bills || [];
                        this.shoppingList = data.shoppingList || [];
                        this.initialCash = data.initialCash || 0;
                    }
                });
            },
            methods: {
                getMemberTotal(name) { return this.bills.filter(b => b.payer === name && b.type === 'æ”¯å‡º').reduce((sum, b) => sum + Number(b.amount), 0); },
                getCatCount(cat) { return this.shoppingList.filter(i => i.category === cat).length; },
                getSortedShopItems(cat) { return this.shoppingList.filter(i => i.category === cat).sort((a, b) => a.isBought - b.isBought); },
                sync() { db.ref(DATA_PATH).set({ itinerary: this.itinerary, bills: this.bills, shoppingList: this.shoppingList, initialCash: this.initialCash }); },
                getTransIcon(t) { return { walk: 'fas fa-walking', bus: 'fas fa-bus', subway: 'fas fa-subway', taxi: 'fas fa-taxi' }[t] || ''; },
                getTransList(str) { return str ? str.split(',').filter(x => x) : []; },
                isTransSelected(t) { return this.getTransList(this.form.transport).includes(t); },
                toggleTrans(t) {
                    let list = this.getTransList(this.form.transport);
                    if(list.includes(t)) list = list.filter(x => x !== t); else list.push(t);
                    this.form.transport = list.join(',');
                },
                toggleBought(id) { const idx = this.shoppingList.findIndex(i => i.id === id); if(idx > -1) { this.shoppingList[idx].isBought = !this.shoppingList[idx].isBought; this.sync(); } },
                setInitialCash() { const val = prompt('è¼¸å…¥åˆå§‹ç¾é‡‘ï¼š', this.initialCash); if(val !== null) { this.initialCash = Number(val); this.sync(); } },
                openAddModal() { this.isEditing = false; this.form = { time: '09:00', place: '', note: '', transport: '', stayTime: '', stayUnit: 'H', mapUrl: '' }; this.showModal = true; },
                openEditModal(idx) { this.isEditing = true; this.editIndex = idx; this.form = {...this.itinerary[this.selectedDay][idx]}; this.showModal = true; },
                saveForm() { if(this.isEditing) this.itinerary[this.selectedDay][this.editIndex] = {...this.form}; else this.itinerary[this.selectedDay].push({...this.form}); this.sync(); this.showModal = false; },
                deleteItem() { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { this.itinerary[this.selectedDay].splice(this.editIndex, 1); this.sync(); this.showModal = false; } },
                openBillModal() { this.isEditBill = false; this.billForm = { itemName: '', amount: 0, method: 'åˆ·å¡', payer: 'å…±åŒ', category: 'é£Ÿç‰©', type: 'æ”¯å‡º', note: '' }; this.showBillModal = true; },
                editBill(idx) { this.isEditBill = true; this.editIndex = idx; this.billForm = {...this.bills[idx]}; this.showBillModal = true; },
                saveBill() { if(this.isEditBill) this.bills[this.editIndex] = {...this.billForm}; else this.bills.unshift({...this.billForm}); this.sync(); this.showBillModal = false; },
                deleteBill() { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { this.bills.splice(this.editIndex, 1); this.sync(); this.showBillModal = false; } },
                openShopModal() { this.isEditShop = false; this.shopForm = { name: '', price: 0, category: 'è³¼ç‰©', imgBase64: '', isBought: false, id: Date.now(), note: '' }; this.showShopModal = true; },
                editShopItem(id) { this.isEditShop = true; this.editIndex = this.shoppingList.findIndex(i => i.id === id); this.shopForm = {...this.shoppingList[this.editIndex]}; this.showShopModal = true; },
                saveShopItem() { if(this.isEditShop) this.shoppingList[this.editIndex] = {...this.shopForm}; else this.shoppingList.push({...this.shopForm}); this.sync(); this.showShopModal = false; },
                deleteShopItem() { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { this.shoppingList.splice(this.editIndex, 1); this.sync(); this.showShopModal = false; } },
                handleFileUpload(e) { const file = e.target.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = (f) => { this.shopForm.imgBase64 = f.target.result; }; reader.readAsDataURL(file); }
            }
        }).mount('#app');
    </script>
</body>
</html>
